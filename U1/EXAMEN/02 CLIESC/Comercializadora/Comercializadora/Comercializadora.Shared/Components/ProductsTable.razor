@using Comercializadora.Core.Models.Comercializadora

@if (IsLoading)
{
    <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando productos...</span>
        </div>
        <p class="mt-3 text-muted">🔄 Cargando productos...</p>
    </div>
}
else if (!Products.Any())
{
    <div class="text-center py-5">
        <div class="display-1 text-muted mb-3">📦</div>
        <h4 class="text-muted">No hay productos disponibles</h4>
        <p class="text-muted">Agrega tu primer producto usando el botón "➕ Nuevo Producto"</p>
    </div>
}
else
{
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead class="table-dark">
                <tr>
                    <th scope="col">Imagen</th>
                    <th scope="col">Código</th>
                    <th scope="col">Nombre</th>
                    <th scope="col">Categoría</th>
                    <th scope="col">Precio</th>
                    <th scope="col">Stock</th>
                    <th scope="col">Estado</th>
                    <th scope="col">Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var product in Products)
                {
                    <tr>
                        <td>
                            @if (!string.IsNullOrEmpty(product.ImagenUrl))
                            {
                                <img src="@product.ImagenUrl" alt="@product.Nombre" 
                                     class="rounded" style="width: 50px; height: 50px; object-fit: cover;" />
                            }
                            else
                            {
                                <div class="bg-light border border-2 border-dashed rounded d-flex align-items-center justify-content-center" 
                                     style="width: 50px; height: 50px;">
                                    🖼️
                                </div>
                            }
                        </td>
                        <td>
                            <code class="bg-light px-2 py-1 rounded">@product.Codigo</code>
                        </td>
                        <td>
                            <div>
                                <strong>@product.Nombre</strong>
                                @if (!string.IsNullOrEmpty(product.Descripcion))
                                {
                                    <br><small class="text-muted">@product.Descripcion</small>
                                }
                            </div>
                        </td>
                        <td>
                            <span class="badge bg-info">@product.Categoria</span>
                        </td>
                        <td>
                            <strong class="text-success">S/ @product.Precio.ToString("N2")</strong>
                        </td>
                        <td>
                            <span class="badge @(GetStockBadgeClass(product.Stock))">
                                @product.Stock unidades
                            </span>
                        </td>
                        <td>
                            <span class="badge @(product.Estado == "ACTIVO" ? "bg-success" : "bg-secondary")">
                                @product.Estado
                            </span>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                <button class="btn btn-outline-primary btn-sm" 
                                        @onclick="() => OnEdit.InvokeAsync(product)"
                                        title="Editar producto">
                                    Editar
                                </button>
                                <button class="btn btn-outline-danger btn-sm"
                                        @onclick="() => OnDelete.InvokeAsync(product.ProductoId)"
                                        title="Eliminar producto">
                                    Eliminar
                                </button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

@code {
    [Parameter] public IEnumerable<ProductDto> Products { get; set; } = new List<ProductDto>();
    [Parameter] public bool IsLoading { get; set; } = false;
    [Parameter] public EventCallback<ProductDto> OnEdit { get; set; }
    [Parameter] public EventCallback<int> OnDelete { get; set; }

    private string GetStockBadgeClass(int stock)
    {
        return stock switch
        {
            > 10 => "bg-success",
            > 0 => "bg-warning text-dark",
            _ => "bg-danger"
        };
    }

    private string GetStockIcon(int stock)
    {
        return stock switch
        {
            > 10 => "📈",
            > 0 => "⚠️",
            _ => "🔴"
        };
    }
}