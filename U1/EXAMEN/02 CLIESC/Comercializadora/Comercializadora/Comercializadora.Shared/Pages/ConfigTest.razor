@page "/config-test"
@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration

<PageTitle>Test de Configuración</PageTitle>

<div class="container mt-4">
    <div class="card">
        <div class="card-header">
            <h3>?? Test de Configuración - Debug</h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h5>Configuración Directa:</h5>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <strong>REST Java:</strong> 
                            <span class="badge bg-@GetBadgeClass(restJava)">@restJava</span>
                        </li>
                        <li class="list-group-item">
                            <strong>REST .NET:</strong> 
                            <span class="badge bg-@GetBadgeClass(restDotNet)">@restDotNet</span>
                        </li>
                        <li class="list-group-item">
                            <strong>SOAP Java:</strong> 
                            <span class="badge bg-@GetBadgeClass(soapJava)">@soapJava</span>
                        </li>
                        <li class="list-group-item">
                            <strong>SOAP .NET:</strong> 
                            <span class="badge bg-@GetBadgeClass(soapDotNet)">@soapDotNet</span>
                        </li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>Análisis de Secciones:</h5>
                    <ul class="list-group">
                        @foreach (var configSection in configSections)
                        {
                            <li class="list-group-item">
                                <strong>@configSection.Key:</strong> @configSection.Value
                            </li>
                        }
                    </ul>
                </div>
            </div>
            
            <div class="mt-3">
                <button class="btn btn-primary" @onclick="RefreshConfig">?? Recargar Configuración</button>
            </div>
        </div>
    </div>
</div>

@code {
    private string restJava = "";
    private string restDotNet = "";
    private string soapJava = "";
    private string soapDotNet = "";
    private Dictionary<string, string> configSections = new();

    protected override void OnInitialized()
    {
        LoadConfig();
    }

    private void LoadConfig()
    {
        // Cargar configuración directa
        restJava = Configuration["Hosts:Comercializadora:Rest:Java"] ?? "NO CONFIGURADA";
        restDotNet = Configuration["Hosts:Comercializadora:Rest:DotNet"] ?? "NO CONFIGURADA";
        soapJava = Configuration["Hosts:Comercializadora:Soap:Java:Products"] ?? "NO CONFIGURADA";
        soapDotNet = Configuration["Hosts:Comercializadora:Soap:DotNet:Products"] ?? "NO CONFIGURADA";

        // Analizar secciones
        configSections.Clear();
        
        var hostsSection = Configuration.GetSection("Hosts");
        configSections["Hosts existe"] = hostsSection.Exists().ToString();
        
        var comercializadoraSection = hostsSection.GetSection("Comercializadora");
        configSections["Comercializadora existe"] = comercializadoraSection.Exists().ToString();
        
        var restSection = comercializadoraSection.GetSection("Rest");
        configSections["Rest existe"] = restSection.Exists().ToString();
        
        var soapSection = comercializadoraSection.GetSection("Soap");
        configSections["Soap existe"] = soapSection.Exists().ToString();
        
        // Verificar rutas específicas
        configSections["Rest Java directo"] = restSection["Java"] ?? "NULL";
        configSections["Rest DotNet directo"] = restSection["DotNet"] ?? "NULL";
        
        var soapDotNetSection = soapSection.GetSection("DotNet");
        configSections["Soap DotNet existe"] = soapDotNetSection.Exists().ToString();
        configSections["Soap DotNet Products"] = soapDotNetSection["Products"] ?? "NULL";
    }

    private void RefreshConfig()
    {
        LoadConfig();
        StateHasChanged();
    }

    private string GetBadgeClass(string value)
    {
        if (value == "NO CONFIGURADA" || value == "NULL")
            return "danger";
        if (Uri.IsWellFormedUriString(value, UriKind.Absolute))
            return "success";
        return "warning";
    }
}