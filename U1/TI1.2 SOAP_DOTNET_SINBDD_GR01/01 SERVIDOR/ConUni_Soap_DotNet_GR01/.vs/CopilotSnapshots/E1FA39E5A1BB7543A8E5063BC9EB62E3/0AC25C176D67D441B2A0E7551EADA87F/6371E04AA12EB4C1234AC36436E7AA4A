using ConUni_Soap_DotNet_GR01.ec.edu.monster.constants;
using ConUni_Soap_DotNet_GR01.ec.edu.monster.models;
using ConUni_Soap_DotNet_GR01.ec.edu.monster.validators;

namespace ConUni_Soap_DotNet_GR01.ec.edu.monster.services
{
    /// <summary>
    /// Servicio de negocio para conversiones de masa
    /// </summary>
    public class MasaBusinessService
    {
        /// <summary>
        /// Convierte gramos a onzas y retorna resultado con manejo de errores
        /// </summary>
        public ConversionResult ConvertirGramoAOnza(string gramosString)
        {
            // Validar y convertir string a double
            var error = BaseValidator.ValidarStringPositivo(gramosString, MasaConstants.GRAMO, out double gramos);
            if (error != null)
                return ConversionResult.Fallo(error);

            try
            {
                double resultadoExacto = gramos * MasaConstants.GRAMO_A_ONZA;
                
                var conversion = new UnidadConversion(
                    gramos, 
                    resultadoExacto, 
                    MasaConstants.GRAMO, 
                    MasaConstants.ONZA, 
                    MasaConstants.GRAMO_A_ONZA
                );

                return ConversionResult.Exito(conversion);
            }
            catch (System.Exception ex)
            {
                var errorInterno = new ConversionError(
                    ErrorConstants.ERROR_CONVERSION_MASA,
                    "Error en la conversión de gramos a onzas",
                    ErrorConstants.TIPO_CONVERSION,
                    gramos,
                    MasaConstants.GRAMO,
                    ex.Message
                );
                return ConversionResult.Fallo(errorInterno);
            }
        }

        /// <summary>
        /// Convierte onzas a gramos y retorna resultado con manejo de errores
        /// </summary>
        public ConversionResult ConvertirOnzaAGramo(string onzasString)
        {
            // Validar y convertir string a double
            var error = BaseValidator.ValidarStringPositivo(onzasString, MasaConstants.ONZA, out double onzas);
            if (error != null)
                return ConversionResult.Fallo(error);

            try
            {
                double resultadoExacto = onzas * MasaConstants.ONZA_A_GRAMO;
                
                var conversion = new UnidadConversion(
                    onzas, 
                    resultadoExacto, 
                    MasaConstants.ONZA, 
                    MasaConstants.GRAMO, 
                    MasaConstants.ONZA_A_GRAMO
                );

                return ConversionResult.Exito(conversion);
            }
            catch (System.Exception ex)
            {
                var errorInterno = new ConversionError(
                    ErrorConstants.ERROR_CONVERSION_MASA,
                    "Error en la conversión de onzas a gramos",
                    ErrorConstants.TIPO_CONVERSION,
                    onzas,
                    MasaConstants.ONZA,
                    ex.Message
                );
                return ConversionResult.Fallo(errorInterno);
            }
        }

        /// <summary>
        /// Convierte gramos a libras y retorna resultado con manejo de errores
        /// </summary>
        public ConversionResult ConvertirGramoALibra(string gramosString)
        {
            // Validar y convertir string a double
            var error = BaseValidator.ValidarStringPositivo(gramosString, MasaConstants.GRAMO, out double gramos);
            if (error != null)
                return ConversionResult.Fallo(error);

            try
            {
                double resultadoExacto = gramos * MasaConstants.GRAMO_A_LIBRA;
                
                var conversion = new UnidadConversion(
                    gramos, 
                    resultadoExacto, 
                    MasaConstants.GRAMO, 
                    MasaConstants.LIBRA, 
                    MasaConstants.GRAMO_A_LIBRA
                );

                return ConversionResult.Exito(conversion);
            }
            catch (System.Exception ex)
            {
                var errorInterno = new ConversionError(
                    ErrorConstants.ERROR_CONVERSION_MASA,
                    "Error en la conversión de gramos a libras",
                    ErrorConstants.TIPO_CONVERSION,
                    gramos,
                    MasaConstants.GRAMO,
                    ex.Message
                );
                return ConversionResult.Fallo(errorInterno);
            }
        }

        /// <summary>
        /// Convierte libras a gramos y retorna resultado con manejo de errores
        /// </summary>
        public ConversionResult ConvertirLibraAGramo(string librasString)
        {
            // Validar y convertir string a double
            var error = BaseValidator.ValidarStringPositivo(librasString, MasaConstants.LIBRA, out double libras);
            if (error != null)
                return ConversionResult.Fallo(error);

            try
            {
                double resultadoExacto = libras * MasaConstants.LIBRA_A_GRAMO;
                
                var conversion = new UnidadConversion(
                    libras, 
                    resultadoExacto, 
                    MasaConstants.LIBRA, 
                    MasaConstants.GRAMO, 
                    MasaConstants.LIBRA_A_GRAMO
                );

                return ConversionResult.Exito(conversion);
            }
            catch (System.Exception ex)
            {
                var errorInterno = new ConversionError(
                    ErrorConstants.ERROR_CONVERSION_MASA,
                    "Error en la conversión de libras a gramos",
                    ErrorConstants.TIPO_CONVERSION,
                    libras,
                    MasaConstants.LIBRA,
                    ex.Message
                );
                return ConversionResult.Fallo(errorInterno);
            }
        }

        /// <summary>
        /// Convierte kilogramos a quintales y retorna resultado con manejo de errores
        /// </summary>
        public ConversionResult ConvertirKilogramoAQuintal(string kilogramosString)
        {
            // Validar y convertir string a double
            var error = BaseValidator.ValidarStringPositivo(kilogramosString, MasaConstants.KILOGRAMO, out double kilogramos);
            if (error != null)
                return ConversionResult.Fallo(error);

            try
            {
                double resultadoExacto = kilogramos * MasaConstants.KILOGRAMO_A_QUINTAL;
                
                var conversion = new UnidadConversion(
                    kilogramos, 
                    resultadoExacto, 
                    MasaConstants.KILOGRAMO, 
                    MasaConstants.QUINTAL, 
                    MasaConstants.KILOGRAMO_A_QUINTAL
                );

                return ConversionResult.Exito(conversion);
            }
            catch (System.Exception ex)
            {
                var errorInterno = new ConversionError(
                    ErrorConstants.ERROR_CONVERSION_MASA,
                    "Error en la conversión de kilogramos a quintales",
                    ErrorConstants.TIPO_CONVERSION,
                    kilogramos,
                    MasaConstants.KILOGRAMO,
                    ex.Message
                );
                return ConversionResult.Fallo(errorInterno);
            }
        }

        /// <summary>
        /// Convierte quintales a kilogramos y retorna resultado con manejo de errores
        /// </summary>
        public ConversionResult ConvertirQuintalAKilogramo(string quintalesString)
        {
            // Validar y convertir string a double
            var error = BaseValidator.ValidarStringPositivo(quintalesString, MasaConstants.QUINTAL, out double quintales);
            if (error != null)
                return ConversionResult.Fallo(error);

            try
            {
                double resultadoExacto = quintales * MasaConstants.QUINTAL_A_KILOGRAMO;
                
                var conversion = new UnidadConversion(
                    quintales, 
                    resultadoExacto, 
                    MasaConstants.QUINTAL, 
                    MasaConstants.KILOGRAMO, 
                    MasaConstants.QUINTAL_A_KILOGRAMO
                );

                return ConversionResult.Exito(conversion);
            }
            catch (System.Exception ex)
            {
                var errorInterno = new ConversionError(
                    ErrorConstants.ERROR_CONVERSION_MASA,
                    "Error en la conversión de quintales a kilogramos",
                    ErrorConstants.TIPO_CONVERSION,
                    quintales,
                    MasaConstants.QUINTAL,
                    ex.Message
                );
                return ConversionResult.Fallo(errorInterno);
            }
        }
    }
}