using ConUni_Soap_DotNet_GR01.ec.edu.monster.constants;
using ConUni_Soap_DotNet_GR01.ec.edu.monster.models;
using ConUni_Soap_DotNet_GR01.ec.edu.monster.validators;

namespace ConUni_Soap_DotNet_GR01.ec.edu.monster.services
{
    /// <summary>
    /// Servicio de negocio para conversiones de masa
    /// </summary>
    public class MasaBusinessService
    {
        #region Conversiones Kilogramo <-> Quintal

        /// <summary>
        /// Convierte kilogramos a quintales y retorna resultado con manejo de errores
        /// </summary>
        public ConversionResult ConvertirKilogramoAQuintal(string kilogramosString)
        {
            // Validar y convertir string a double
            var error = BaseValidator.ValidarStringPositivo(kilogramosString, MasaConstants.KILOGRAMO, out double kilogramos);
            if (error != null)
                return ConversionResult.Fallo(error);

            try
            {
                double resultadoExacto = kilogramos * MasaConstants.KILOGRAMO_A_QUINTAL;
                
                var conversion = new UnidadConversion(
                    kilogramos, 
                    resultadoExacto, 
                    MasaConstants.KILOGRAMO, 
                    MasaConstants.QUINTAL, 
                    MasaConstants.KILOGRAMO_A_QUINTAL
                );

                return ConversionResult.Exito(conversion);
            }
            catch (System.Exception ex)
            {
                var errorInterno = new ConversionError(
                    ErrorConstants.ERROR_CONVERSION_MASA,
                    "Error en la conversión de kilogramos a quintales",
                    ErrorConstants.TIPO_CONVERSION,
                    kilogramos,
                    MasaConstants.KILOGRAMO,
                    ex.Message
                );
                return ConversionResult.Fallo(errorInterno);
            }
        }

        /// <summary>
        /// Convierte quintales a kilogramos y retorna resultado con manejo de errores
        /// </summary>
        public ConversionResult ConvertirQuintalAKilogramo(string quintalesString)
        {
            // Validar y convertir string a double
            var error = BaseValidator.ValidarStringPositivo(quintalesString, MasaConstants.QUINTAL, out double quintales);
            if (error != null)
                return ConversionResult.Fallo(error);

            try
            {
                double resultadoExacto = quintales * MasaConstants.QUINTAL_A_KILOGRAMO;
                
                var conversion = new UnidadConversion(
                    quintales, 
                    resultadoExacto, 
                    MasaConstants.QUINTAL, 
                    MasaConstants.KILOGRAMO, 
                    MasaConstants.QUINTAL_A_KILOGRAMO
                );

                return ConversionResult.Exito(conversion);
            }
            catch (System.Exception ex)
            {
                var errorInterno = new ConversionError(
                    ErrorConstants.ERROR_CONVERSION_MASA,
                    "Error en la conversión de quintales a kilogramos",
                    ErrorConstants.TIPO_CONVERSION,
                    quintales,
                    MasaConstants.QUINTAL,
                    ex.Message
                );
                return ConversionResult.Fallo(errorInterno);
            }
        }

        #endregion

        #region Conversiones Kilogramo <-> Libra

        /// <summary>
        /// Convierte kilogramos a libras y retorna resultado con manejo de errores
        /// </summary>
        public ConversionResult ConvertirKilogramoALibra(string kilogramosString)
        {
            // Validar y convertir string a double
            var error = BaseValidator.ValidarStringPositivo(kilogramosString, MasaConstants.KILOGRAMO, out double kilogramos);
            if (error != null)
                return ConversionResult.Fallo(error);

            try
            {
                double resultadoExacto = kilogramos * MasaConstants.KILOGRAMO_A_LIBRA;
                
                var conversion = new UnidadConversion(
                    kilogramos, 
                    resultadoExacto, 
                    MasaConstants.KILOGRAMO, 
                    MasaConstants.LIBRA, 
                    MasaConstants.KILOGRAMO_A_LIBRA
                );

                return ConversionResult.Exito(conversion);
            }
            catch (System.Exception ex)
            {
                var errorInterno = new ConversionError(
                    ErrorConstants.ERROR_CONVERSION_MASA,
                    "Error en la conversión de kilogramos a libras",
                    ErrorConstants.TIPO_CONVERSION,
                    kilogramos,
                    MasaConstants.KILOGRAMO,
                    ex.Message
                );
                return ConversionResult.Fallo(errorInterno);
            }
        }

        /// <summary>
        /// Convierte libras a kilogramos y retorna resultado con manejo de errores
        /// </summary>
        public ConversionResult ConvertirLibraAKilogramo(string librasString)
        {
            // Validar y convertir string a double
            var error = BaseValidator.ValidarStringPositivo(librasString, MasaConstants.LIBRA, out double libras);
            if (error != null)
                return ConversionResult.Fallo(error);

            try
            {
                double resultadoExacto = libras * MasaConstants.LIBRA_A_KILOGRAMO;
                
                var conversion = new UnidadConversion(
                    libras, 
                    resultadoExacto, 
                    MasaConstants.LIBRA, 
                    MasaConstants.KILOGRAMO, 
                    MasaConstants.LIBRA_A_KILOGRAMO
                );

                return ConversionResult.Exito(conversion);
            }
            catch (System.Exception ex)
            {
                var errorInterno = new ConversionError(
                    ErrorConstants.ERROR_CONVERSION_MASA,
                    "Error en la conversión de libras a kilogramos",
                    ErrorConstants.TIPO_CONVERSION,
                    libras,
                    MasaConstants.LIBRA,
                    ex.Message
                );
                return ConversionResult.Fallo(errorInterno);
            }
        }

        #endregion

        #region Conversiones Quintal <-> Libra

        /// <summary>
        /// Convierte quintales a libras y retorna resultado con manejo de errores
        /// </summary>
        public ConversionResult ConvertirQuintalALibra(string quintalesString)
        {
            // Validar y convertir string a double
            var error = BaseValidator.ValidarStringPositivo(quintalesString, MasaConstants.QUINTAL, out double quintales);
            if (error != null)
                return ConversionResult.Fallo(error);

            try
            {
                double resultadoExacto = quintales * MasaConstants.QUINTAL_A_LIBRA;
                
                var conversion = new UnidadConversion(
                    quintales, 
                    resultadoExacto, 
                    MasaConstants.QUINTAL, 
                    MasaConstants.LIBRA, 
                    MasaConstants.QUINTAL_A_LIBRA
                );

                return ConversionResult.Exito(conversion);
            }
            catch (System.Exception ex)
            {
                var errorInterno = new ConversionError(
                    ErrorConstants.ERROR_CONVERSION_MASA,
                    "Error en la conversión de quintales a libras",
                    ErrorConstants.TIPO_CONVERSION,
                    quintales,
                    MasaConstants.QUINTAL,
                    ex.Message
                );
                return ConversionResult.Fallo(errorInterno);
            }
        }

        /// <summary>
        /// Convierte libras a quintales y retorna resultado con manejo de errores
        /// </summary>
        public ConversionResult ConvertirLibraAQuintal(string librasString)
        {
            // Validar y convertir string a double
            var error = BaseValidator.ValidarStringPositivo(librasString, MasaConstants.LIBRA, out double libras);
            if (error != null)
                return ConversionResult.Fallo(error);

            try
            {
                double resultadoExacto = libras * MasaConstants.LIBRA_A_QUINTAL;
                
                var conversion = new UnidadConversion(
                    libras, 
                    resultadoExacto, 
                    MasaConstants.LIBRA, 
                    MasaConstants.QUINTAL, 
                    MasaConstants.LIBRA_A_QUINTAL
                );

                return ConversionResult.Exito(conversion);
            }
            catch (System.Exception ex)
            {
                var errorInterno = new ConversionError(
                    ErrorConstants.ERROR_CONVERSION_MASA,
                    "Error en la conversión de libras a quintales",
                    ErrorConstants.TIPO_CONVERSION,
                    libras,
                    MasaConstants.LIBRA,
                    ex.Message
                );
                return ConversionResult.Fallo(errorInterno);
            }
        }

        #endregion
    }
}